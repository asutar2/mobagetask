<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëª¨ë°”ì¼ ê²Œì„ ê´€ë¦¬ ë„êµ¬</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .tabs {
            display: flex;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            border: none;
            background: none;
            font-size: 1.1rem;
        }

        .tab:hover {
            background: #e2e8f0;
        }

        .tab.active {
            background: #4f46e5;
            color: white;
        }

        .content {
            padding: 30px;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .form-group {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 10px;
            border: 2px solid #e2e8f0;
            flex-wrap: wrap;
        }

        .form-group input, .form-group select {
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 200px;
        }

        .form-group input:focus, .form-group select:focus {
            border-color: #4f46e5;
            outline: none;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(79, 70, 229, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            padding: 8px 16px;
            font-size: 12px;
        }

        .btn-danger:hover {
            box-shadow: 0 10px 20px rgba(239, 68, 68, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
            padding: 8px 16px;
            font-size: 12px;
        }

        .btn-success:hover {
            box-shadow: 0 10px 20px rgba(16, 185, 129, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6b7280, #4b5563);
            padding: 8px 16px;
            font-size: 12px;
        }

        .btn-secondary:hover {
            box-shadow: 0 10px 20px rgba(107, 114, 128, 0.3);
        }

        .table-container {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid #e2e8f0;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        th {
            background: #f8fafc;
            font-weight: 600;
            color: #374151;
        }

        tr:hover {
            background: #f8fafc;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid #e2e8f0;
        }

        .summary-card h3 {
            color: #4f46e5;
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .summary-card p {
            color: #64748b;
            font-weight: 500;
        }

        .export-btn {
            background: linear-gradient(135deg, #059669, #047857);
        }

        .export-btn:hover {
            box-shadow: 0 10px 20px rgba(5, 150, 105, 0.3);
        }

        .calendar-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #e2e8f0;
            margin-top: 20px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: #e2e8f0;
        }

        .calendar-day {
            background: white;
            padding: 10px;
            min-height: 80px;
            position: relative;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .calendar-day:hover {
            background: #f8fafc;
        }

        .calendar-day.today {
            background: #ddd6fe;
        }

        .calendar-day.other-month {
            color: #9ca3af;
            background: #f9fafb;
        }

        .day-number {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .quest-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin: 1px;
        }

        .quest-incomplete {
            background: #fbbf24;
        }

        .quest-complete {
            background: #10b981;
        }

        .calendar-day-names {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            margin-bottom: 1px;
            background: #e2e8f0;
        }

        .day-name {
            background: #f8fafc;
            padding: 10px;
            text-align: center;
            font-weight: 600;
            color: #374151;
        }

        .delete-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s ease;
        }

        .delete-modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .delete-modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease;
        }

        .delete-modal h3 {
            color: #374151;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .delete-modal p {
            color: #6b7280;
            margin-bottom: 25px;
            line-height: 1.5;
        }

        .delete-modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .form-group {
                flex-direction: column;
            }
            
            .form-group input {
                min-width: auto;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .summary-cards {
                grid-template-columns: 1fr;
            }

            .delete-modal-content {
                width: 95%;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ® ëª¨ë°”ì¼ ê²Œì„ ê´€ë¦¬ ë„êµ¬</h1>
            <p>ì¼ì¼ í€˜ìŠ¤íŠ¸ì™€ ê²°ì œ ê¸ˆì•¡ì„ ê°„ë‹¨í•˜ê²Œ ê´€ë¦¬í•˜ì„¸ìš”</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('daily')">ì¼ì¼ í€˜ìŠ¤íŠ¸</button>
            <button class="tab" onclick="switchTab('calendar')">ë‹¬ë ¥</button>
            <button class="tab" onclick="switchTab('payment')">ê²°ì œ ê¸ˆì•¡</button>
            <button class="tab" onclick="switchTab('summary')">ìš”ì•½</button>
        </div>

        <div class="content">
            <!-- ì¼ì¼ í€˜ìŠ¤íŠ¸ ì„¹ì…˜ -->
            <div id="daily" class="section active">
                <h2>ì¼ì¼ í€˜ìŠ¤íŠ¸ ê´€ë¦¬</h2>
                <div class="form-group">
                    <input type="text" id="gameName" placeholder="ê²Œì„ ì´ë¦„" list="gameList">
                    <datalist id="gameList"></datalist>
                    <button class="btn" onclick="addQuest()">ê²Œì„ ì¶”ê°€</button>
                </div>

                <div class="table-container">
                    <table id="questTable">
                        <thead>
                            <tr>
                                <th>ê²Œì„</th>
                                <th>ìƒíƒœ</th>
                                <th>ê´€ë¦¬</th>
                            </tr>
                        </thead>
                        <tbody id="questBody">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- ë‹¬ë ¥ ì„¹ì…˜ -->
            <div id="calendar" class="section">
                <h2>ë‹¬ë ¥ - ì¼ì¼ í€˜ìŠ¤íŠ¸ í˜„í™©</h2>
                <div class="calendar-container">
                    <div class="calendar-header">
                        <button class="btn" onclick="changeMonth(-1)">â—€ ì´ì „ë‹¬</button>
                        <h3 id="currentMonth"></h3>
                        <button class="btn" onclick="changeMonth(1)">ë‹¤ìŒë‹¬ â–¶</button>
                    </div>
                    <div class="calendar-day-names">
                        <div class="day-name">ì¼</div>
                        <div class="day-name">ì›”</div>
                        <div class="day-name">í™”</div>
                        <div class="day-name">ìˆ˜</div>
                        <div class="day-name">ëª©</div>
                        <div class="day-name">ê¸ˆ</div>
                        <div class="day-name">í† </div>
                    </div>
                    <div class="calendar-grid" id="calendarGrid">
                    </div>
                </div>
            </div>

            <!-- ê²°ì œ ê¸ˆì•¡ ì„¹ì…˜ -->
            <div id="payment" class="section">
                <h2>ê²°ì œ ê¸ˆì•¡ ê´€ë¦¬</h2>
                <div class="form-group">
                    <select id="payGameName">
                        <option value="">ê²Œì„ ì„ íƒ</option>
                    </select>
                    <input type="number" id="amount" placeholder="ê²°ì œ ê¸ˆì•¡ (ì›)" step="100">
                    <button class="btn" onclick="addPayment()">ê²°ì œ ê¸°ë¡ ì¶”ê°€</button>
                </div>

                <div class="table-container">
                    <table id="paymentTable">
                        <thead>
                            <tr>
                                <th>ê²Œì„</th>
                                <th>ê¸ˆì•¡</th>
                                <th>ê²°ì œì¼</th>
                                <th>ê´€ë¦¬</th>
                            </tr>
                        </thead>
                        <tbody id="paymentBody">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- ìš”ì•½ ì„¹ì…˜ -->
            <div id="summary" class="section">
                <h2>í†µê³„ ìš”ì•½</h2>
                <div class="summary-cards">
                    <div class="summary-card">
                        <h3 id="totalQuests">0</h3>
                        <p>ì´ í€˜ìŠ¤íŠ¸ ìˆ˜</p>
                    </div>
                    <div class="summary-card">
                        <h3 id="completedQuests">0</h3>
                        <p>ì™„ë£Œëœ í€˜ìŠ¤íŠ¸</p>
                    </div>
                    <div class="summary-card">
                        <h3 id="totalPayments">0ì›</h3>
                        <p>ì´ ê²°ì œ ê¸ˆì•¡</p>
                    </div>
                    <div class="summary-card">
                        <h3 id="monthlyPayments">0ì›</h3>
                        <p>ì´ë‹¬ ê²°ì œ ê¸ˆì•¡</p>
                    </div>
                </div>

                <h3 style="margin-bottom: 20px; color: #374151;">ê²Œì„ë³„ í†µê³„</h3>
                <div class="summary-cards" id="gameStats">
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn export-btn" onclick="exportData()">ë°ì´í„° ë‚´ë³´ë‚´ê¸°</button>
                    <button class="btn btn-danger" onclick="clearAllData()">ëª¨ë“  ë°ì´í„° ì‚­ì œ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ë°ì´í„° ì €ì¥ì†Œ
        let quests = [];
        let payments = [];
        let questCompletions = {}; // ë‚ ì§œë³„ í€˜ìŠ¤íŠ¸ ì™„ë£Œ ìƒíƒœ ì €ì¥
        let currentDate = new Date();
        let deleteCallback = null; // ì‚­ì œ ì½œë°± í•¨ìˆ˜

        // localStorage ê´€ë ¨ í•¨ìˆ˜
        function saveData() {
            const data = {
                quests,
                payments,
                questCompletions,
                lastSaved: new Date().toISOString()
            };
            localStorage.setItem('gameManagerData', JSON.stringify(data));
            console.log('ë°ì´í„° ì €ì¥ë¨:', data);
        }

        function loadData() {
            const savedData = localStorage.getItem('gameManagerData');
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    quests = data.quests || [];
                    payments = data.payments || [];
                    questCompletions = data.questCompletions || {};
                    console.log('ë°ì´í„° ë¡œë“œë¨:', data);
                    return true;
                } catch (error) {
                    console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                    return false;
                }
            }
            return false;
        }

        // ê²Œì„ ëª©ë¡ ê´€ë¦¬
        function getGameList() {
            return [...new Set(quests.map(q => q.gameName))].sort();
        }

        function updateGameSelectors() {
            // ì¼ì¼í€˜ìŠ¤íŠ¸ datalist ì—…ë°ì´íŠ¸
            const gameList = document.getElementById('gameList');
            gameList.innerHTML = '';
            getGameList().forEach(gameName => {
                const option = document.createElement('option');
                option.value = gameName;
                gameList.appendChild(option);
            });

            // ê²°ì œ íƒ­ select ì—…ë°ì´íŠ¸
            const payGameSelect = document.getElementById('payGameName');
            const currentValue = payGameSelect.value;
            payGameSelect.innerHTML = '<option value="">ê²Œì„ ì„ íƒ</option>';
            getGameList().forEach(gameName => {
                const option = document.createElement('option');
                option.value = gameName;
                option.textContent = gameName;
                payGameSelect.appendChild(option);
            });
            payGameSelect.value = currentValue; // ê¸°ì¡´ ì„ íƒ ìœ ì§€
        }

        // ëª¨ë‹¬ ìƒì„± í•¨ìˆ˜
        function createModal() {
            // ê¸°ì¡´ ëª¨ë‹¬ì´ ìˆìœ¼ë©´ ì œê±°
            const existingModal = document.getElementById('deleteModal');
            if (existingModal) {
                existingModal.remove();
            }

            // ìƒˆ ëª¨ë‹¬ ìƒì„±
            const modal = document.createElement('div');
            modal.id = 'deleteModal';
            modal.className = 'delete-modal';
            
            modal.innerHTML = `
                <div class="delete-modal-content">
                    <h3>ì‚­ì œ í™•ì¸</h3>
                    <p id="deleteMessage">ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
                    <div class="delete-modal-buttons">
                        <button class="btn btn-secondary" onclick="closeDeleteModal()">ì·¨ì†Œ</button>
                        <button class="btn btn-danger" onclick="confirmDelete()">ì‚­ì œ</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            console.log('ëª¨ë‹¬ ë™ì  ìƒì„±ë¨:', modal);
            return modal;
        }

        // ì‚­ì œ ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜
        function showDeleteModal(message, callback) {
            console.log('ëª¨ë‹¬ í‘œì‹œ ì‹œë„:', message);
            
            // ëª¨ë‹¬ ìƒì„± ë˜ëŠ” ì°¾ê¸°
            let modal = document.getElementById('deleteModal');
            if (!modal) {
                console.log('ê¸°ì¡´ ëª¨ë‹¬ì´ ì—†ìŒ, ìƒˆë¡œ ìƒì„±');
                modal = createModal();
            }
            
            const messageElement = document.getElementById('deleteMessage');
            
            console.log('ëª¨ë‹¬ ìš”ì†Œ:', modal);
            console.log('ë©”ì‹œì§€ ìš”ì†Œ:', messageElement);
            
            if (!modal) {
                console.error('ëª¨ë‹¬ ìƒì„± ì‹¤íŒ¨');
                if (confirm(message)) {
                    callback();
                }
                return;
            }
            
            if (!messageElement) {
                console.error('ë©”ì‹œì§€ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                if (confirm(message)) {
                    callback();
                }
                return;
            }
            
            messageElement.textContent = message;
            modal.style.display = 'flex';
            modal.classList.add('show');
            deleteCallback = callback;
            
            console.log('ëª¨ë‹¬ í‘œì‹œë¨');
        }

        function closeDeleteModal() {
            console.log('ëª¨ë‹¬ ë‹«ê¸°');
            const modal = document.getElementById('deleteModal');
            if (modal) {
                modal.style.display = 'none';
                modal.classList.remove('show');
            }
            deleteCallback = null;
        }

        function confirmDelete() {
            console.log('ì‚­ì œ í™•ì¸');
            if (deleteCallback) {
                deleteCallback();
            }
            closeDeleteModal();
        }

        // íƒ­ ì „í™˜
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
            
            document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'summary') {
                updateSummary();
            } else if (tabName === 'calendar') {
                renderCalendar();
            }
        }

        // í€˜ìŠ¤íŠ¸ ì¶”ê°€
        function addQuest() {
            const gameName = document.getElementById('gameName').value.trim();

            if (!gameName) {
                alert('ê²Œì„ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ê²Œì„ì¸ì§€ í™•ì¸
            const existingQuest = quests.find(q => q.gameName === gameName);
            if (existingQuest) {
                alert('ì´ë¯¸ ë“±ë¡ëœ ê²Œì„ì…ë‹ˆë‹¤.');
                return;
            }

            const quest = {
                id: Date.now(),
                gameName
            };

            quests.push(quest);
            saveData();
            renderQuests();
            updateGameSelectors();
            clearQuestForm();
        }

        // ê²°ì œ ë‚´ì—­ ì¶”ê°€
        function addPayment() {
            const payGameName = document.getElementById('payGameName').value;
            const amount = parseInt(document.getElementById('amount').value);

            if (!payGameName) {
                alert('ê²Œì„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            if (!amount || amount <= 0) {
                alert('ì˜¬ë°”ë¥¸ ê¸ˆì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const payment = {
                id: Date.now(),
                gameName: payGameName,
                amount,
                date: new Date().toLocaleDateString('ko-KR')
            };

            payments.push(payment);
            saveData();
            renderPayments();
            clearPaymentForm();
        }

        // í€˜ìŠ¤íŠ¸ ë Œë”ë§
        function renderQuests() {
            const tbody = document.getElementById('questBody');
            tbody.innerHTML = '';

            const today = new Date().toDateString();

            quests.forEach((quest, index) => {
                const row = document.createElement('tr');
                
                // ê²Œì„ëª…
                const gameCell = document.createElement('td');
                gameCell.textContent = quest.gameName;
                row.appendChild(gameCell);

                // ìƒíƒœ (ì˜¤ëŠ˜ ê¸°ì¤€)
                const statusCell = document.createElement('td');
                const isCompleted = questCompletions[today] && questCompletions[today][quest.id];
                
                const statusBtn = document.createElement('button');
                statusBtn.className = isCompleted ? 'btn btn-success' : 'btn btn-secondary';
                statusBtn.textContent = isCompleted ? 'ì™„ë£Œ' : 'ë¯¸ì™„ë£Œ';
                statusBtn.addEventListener('click', function() {
                    toggleQuestCompletion(quest.id, today);
                });
                statusCell.appendChild(statusBtn);
                row.appendChild(statusCell);

                // ê´€ë¦¬ (ì‚­ì œ ë²„íŠ¼)
                const manageCell = document.createElement('td');
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'btn btn-danger';
                deleteBtn.textContent = 'ì‚­ì œ';
                deleteBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const message = `"${quest.gameName}" ê²Œì„ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(ê´€ë ¨ëœ ëª¨ë“  ì™„ë£Œ ê¸°ë¡ê³¼ ê²°ì œ ë‚´ì—­ë„ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤)`;
                    
                    showDeleteModal(message, function() {
                        // í€˜ìŠ¤íŠ¸ ë°°ì—´ì—ì„œ ì œê±°
                        quests.splice(index, 1);
                        
                        // ì™„ë£Œ ê¸°ë¡ì—ì„œë„ ì œê±°
                        Object.keys(questCompletions).forEach(date => {
                            if (questCompletions[date] && questCompletions[date][quest.id]) {
                                delete questCompletions[date][quest.id];
                            }
                        });
                        
                        // í•´ë‹¹ ê²Œì„ì˜ ê²°ì œ ë‚´ì—­ë„ ì œê±°
                        payments = payments.filter(p => p.gameName !== quest.gameName);
                        
                        saveData();
                        renderQuests();
                        renderPayments();
                        renderCalendar();
                        updateSummary();
                        updateGameSelectors();
                    });
                });
                manageCell.appendChild(deleteBtn);
                row.appendChild(manageCell);

                tbody.appendChild(row);
            });
        }

        // ê²°ì œ ë‚´ì—­ ë Œë”ë§
        function renderPayments() {
            const tbody = document.getElementById('paymentBody');
            tbody.innerHTML = '';

            payments.forEach((payment, index) => {
                const row = document.createElement('tr');
                
                const gameCell = document.createElement('td');
                gameCell.textContent = payment.gameName;
                row.appendChild(gameCell);

                const amountCell = document.createElement('td');
                amountCell.textContent = payment.amount.toLocaleString() + 'ì›';
                row.appendChild(amountCell);

                const dateCell = document.createElement('td');
                dateCell.textContent = payment.date;
                row.appendChild(dateCell);

                const manageCell = document.createElement('td');
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'btn btn-danger';
                deleteBtn.textContent = 'ì‚­ì œ';
                deleteBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const message = `"${payment.gameName}" ê²Œì„ì˜ ${payment.amount.toLocaleString()}ì› ê²°ì œ ë‚´ì—­ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;
                    
                    showDeleteModal(message, function() {
                        payments.splice(index, 1);
                        
                        saveData();
                        renderPayments();
                        updateSummary();
                    });
                });
                manageCell.appendChild(deleteBtn);
                row.appendChild(manageCell);

                tbody.appendChild(row);
            });
        }

        // í€˜ìŠ¤íŠ¸ ì™„ë£Œ í† ê¸€
        function toggleQuestCompletion(questId, dateString) {
            if (!questCompletions[dateString]) {
                questCompletions[dateString] = {};
            }
            questCompletions[dateString][questId] = !questCompletions[dateString][questId];
            saveData();
            renderQuests();
            renderCalendar();
            updateSummary();
        }

        // ë‹¬ë ¥ ë Œë”ë§
        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            document.getElementById('currentMonth').textContent = `${year}ë…„ ${month + 1}ì›”`;
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            const calendarGrid = document.getElementById('calendarGrid');
            calendarGrid.innerHTML = '';
            
            const today = new Date();
            
            for (let i = 0; i < 42; i++) {
                const cellDate = new Date(startDate);
                cellDate.setDate(startDate.getDate() + i);
                
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                
                if (cellDate.getMonth() !== month) {
                    dayElement.classList.add('other-month');
                }
                
                if (cellDate.toDateString() === today.toDateString()) {
                    dayElement.classList.add('today');
                }
                
                const dayNumber = document.createElement('div');
                dayNumber.className = 'day-number';
                dayNumber.textContent = cellDate.getDate();
                dayElement.appendChild(dayNumber);
                
                // í•´ë‹¹ ë‚ ì§œì˜ í€˜ìŠ¤íŠ¸ ì™„ë£Œ ìƒíƒœ í‘œì‹œ
                const dateString = cellDate.toDateString();
                if (questCompletions[dateString]) {
                    quests.forEach(quest => {
                        const dot = document.createElement('span');
                        dot.className = 'quest-dot';
                        if (questCompletions[dateString][quest.id]) {
                            dot.classList.add('quest-complete');
                            dot.title = `${quest.gameName} (ì™„ë£Œ)`;
                        } else {
                            dot.classList.add('quest-incomplete');
                            dot.title = `${quest.gameName} (ë¯¸ì™„ë£Œ)`;
                        }
                        dayElement.appendChild(dot);
                    });
                }
                
                calendarGrid.appendChild(dayElement);
            }
        }

        // ë‹¬ ë³€ê²½
        function changeMonth(delta) {
            currentDate.setMonth(currentDate.getMonth() + delta);
            renderCalendar();
        }

        // ìš”ì•½ ì—…ë°ì´íŠ¸
        function updateSummary() {
            const totalQuests = quests.length;
            const today = new Date().toDateString();
            const completedToday = questCompletions[today] ? 
                Object.values(questCompletions[today]).filter(Boolean).length : 0;
            
            const totalPayments = payments.reduce((sum, p) => sum + p.amount, 0);
            
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            const monthlyPayments = payments.filter(p => {
                const [year, month] = p.date.split('. ');
                return parseInt(month) - 1 === currentMonth && parseInt(year) === currentYear;
            }).reduce((sum, p) => sum + p.amount, 0);

            document.getElementById('totalQuests').textContent = totalQuests;
            document.getElementById('completedQuests').textContent = completedToday;
            document.getElementById('totalPayments').textContent = totalPayments.toLocaleString() + 'ì›';
            document.getElementById('monthlyPayments').textContent = monthlyPayments.toLocaleString() + 'ì›';

            updateGameStats();
        }

        // ê²Œì„ë³„ í†µê³„ ì—…ë°ì´íŠ¸
        function updateGameStats() {
            const gameStatsContainer = document.getElementById('gameStats');
            if (!gameStatsContainer) return;

            const allGames = [...new Set([
                ...quests.map(q => q.gameName),
                ...payments.map(p => p.gameName)
            ])];

            gameStatsContainer.innerHTML = '';

            allGames.forEach(gameName => {
                const gameQuests = quests.filter(q => q.gameName === gameName);
                const gamePayments = payments.filter(p => p.gameName === gameName);
                
                const today = new Date().toDateString();
                const completedGameQuests = gameQuests.filter(q => 
                    questCompletions[today] && questCompletions[today][q.id]
                ).length;
                
                const totalGamePayment = gamePayments.reduce((sum, p) => sum + p.amount, 0);

                const gameCard = document.createElement('div');
                gameCard.className = 'summary-card';
                gameCard.innerHTML = `
                    <h4 style="color: #4f46e5; margin-bottom: 10px;">${gameName}</h4>
                    <p>ì˜¤ëŠ˜ í€˜ìŠ¤íŠ¸: ${completedGameQuests}/${gameQuests.length}ê°œ ì™„ë£Œ</p>
                    <p>ì´ ê²°ì œ: ${totalGamePayment.toLocaleString()}ì›</p>
                `;
                gameStatsContainer.appendChild(gameCard);
            });
        }

        // í¼ ì´ˆê¸°í™”
        function clearQuestForm() {
            document.getElementById('gameName').value = '';
        }

        function clearPaymentForm() {
            document.getElementById('payGameName').value = '';
            document.getElementById('amount').value = '';
        }

        // ë°ì´í„° ë‚´ë³´ë‚´ê¸°
        function exportData() {
            const data = {
                quests,
                payments,
                questCompletions,
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `ê²Œì„ê´€ë¦¬_${new Date().toLocaleDateString('ko-KR').replace(/\./g, '').replace(/ /g, '')}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // ëª¨ë“  ë°ì´í„° ì‚­ì œ
        function clearAllData() {
            const message = 'ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
            
            showDeleteModal(message, function() {
                quests.length = 0;
                payments.length = 0;
                questCompletions = {};
                
                localStorage.removeItem('gameManagerData');
                
                renderQuests();
                renderPayments();
                renderCalendar();
                updateSummary();
                updateGameSelectors();
            });
        }

        // ì´ˆê¸° ë Œë”ë§
        loadData();
        
        renderQuests();
        renderPayments();
        renderCalendar();
        updateSummary();
        updateGameSelectors();

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ëª¨ë‹¬ ë¯¸ë¦¬ ìƒì„±
        createModal();
        console.log('localStorage ê¸°ëŠ¥ì´ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
    </script>
</body>
</html>