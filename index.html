<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Î™®Î∞îÏùº Í≤åÏûÑ Í¥ÄÎ¶¨ ÎèÑÍµ¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .tabs {
            display: flex;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            border: none;
            background: none;
            font-size: 1.1rem;
        }

        .tab:hover {
            background: #e2e8f0;
        }

        .tab.active {
            background: #4f46e5;
            color: white;
        }

        .content {
            padding: 30px;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .form-group {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 10px;
            border: 2px solid #e2e8f0;
            flex-wrap: wrap;
        }

        .form-group input, .form-group select {
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 200px;
        }

        .form-group input:focus, .form-group select:focus {
            border-color: #4f46e5;
            outline: none;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(79, 70, 229, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            padding: 8px 16px;
            font-size: 12px;
        }

        .btn-danger:hover {
            box-shadow: 0 10px 20px rgba(239, 68, 68, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
            padding: 8px 16px;
            font-size: 12px;
        }

        .btn-success:hover {
            box-shadow: 0 10px 20px rgba(16, 185, 129, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6b7280, #4b5563);
            padding: 8px 16px;
            font-size: 12px;
        }

        .btn-secondary:hover {
            box-shadow: 0 10px 20px rgba(107, 114, 128, 0.3);
        }

        .table-container {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid #e2e8f0;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        th {
            background: #f8fafc;
            font-weight: 600;
            color: #374151;
        }

        tr:hover {
            background: #f8fafc;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid #e2e8f0;
        }

        .summary-card h3 {
            color: #4f46e5;
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .summary-card p {
            color: #64748b;
            font-weight: 500;
        }

        .export-btn {
            background: linear-gradient(135deg, #059669, #047857);
        }

        .export-btn:hover {
            box-shadow: 0 10px 20px rgba(5, 150, 105, 0.3);
        }

        .calendar-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #e2e8f0;
            margin-top: 20px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: #e2e8f0;
        }

        .calendar-day {
            background: white;
            padding: 10px;
            min-height: 80px;
            position: relative;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .calendar-day:hover {
            background: #f8fafc;
        }

        .calendar-day.today {
            background: #ddd6fe;
        }

        .calendar-day.other-month {
            color: #9ca3af;
            background: #f9fafb;
        }

        .day-number {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .quest-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin: 1px;
        }

        .quest-incomplete {
            background: #fbbf24;
        }

        .quest-complete {
            background: #10b981;
        }

        .calendar-day-names {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            margin-bottom: 1px;
            background: #e2e8f0;
        }

        .day-name {
            background: #f8fafc;
            padding: 10px;
            text-align: center;
            font-weight: 600;
            color: #374151;
        }

        .delete-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s ease;
        }

        .delete-modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .delete-modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease;
        }

        .delete-modal h3 {
            color: #374151;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .delete-modal p {
            color: #6b7280;
            margin-bottom: 25px;
            line-height: 1.5;
        }

        .delete-modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .form-group {
                flex-direction: column;
            }
            
            .form-group input {
                min-width: auto;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .summary-cards {
                grid-template-columns: 1fr;
            }

            .delete-modal-content {
                width: 95%;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéÆ Î™®Î∞îÏùº Í≤åÏûÑ Í¥ÄÎ¶¨ ÎèÑÍµ¨</h1>
            <p>ÏùºÏùº ÌÄòÏä§Ìä∏ÏôÄ Í≤∞Ï†ú Í∏àÏï°ÏùÑ Í∞ÑÎã®ÌïòÍ≤å Í¥ÄÎ¶¨ÌïòÏÑ∏Ïöî</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('daily')">ÏùºÏùº ÌÄòÏä§Ìä∏</button>
            <button class="tab" onclick="switchTab('calendar')">Îã¨Î†•</button>
            <button class="tab" onclick="switchTab('payment')">Í≤∞Ï†ú Í∏àÏï°</button>
            <button class="tab" onclick="switchTab('summary')">ÏöîÏïΩ</button>
        </div>

        <div class="content">
            <!-- ÏùºÏùº ÌÄòÏä§Ìä∏ ÏÑπÏÖò -->
            <div id="daily" class="section active">
                <h2>ÏùºÏùº ÌÄòÏä§Ìä∏ Í¥ÄÎ¶¨</h2>
                <div class="form-group">
                    <input type="text" id="gameName" placeholder="Í≤åÏûÑ Ïù¥Î¶Ñ" list="gameList">
                    <datalist id="gameList"></datalist>
                    <button class="btn" onclick="addQuest()">Í≤åÏûÑ Ï∂îÍ∞Ä</button>
                </div>

                <div class="table-container">
                    <table id="questTable">
                        <thead>
                            <tr>
                                <th>Í≤åÏûÑ</th>
                                <th>ÏÉÅÌÉú</th>
                                <th>Í¥ÄÎ¶¨</th>
                            </tr>
                        </thead>
                        <tbody id="questBody">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Îã¨Î†• ÏÑπÏÖò -->
            <div id="calendar" class="section">
                <h2>Îã¨Î†• - ÏùºÏùº ÌÄòÏä§Ìä∏ ÌòÑÌô©</h2>
                <div class="calendar-container">
                    <div class="calendar-header">
                        <button class="btn" onclick="changeMonth(-1)">‚óÄ Ïù¥Ï†ÑÎã¨</button>
                        <h3 id="currentMonth"></h3>
                        <button class="btn" onclick="changeMonth(1)">Îã§ÏùåÎã¨ ‚ñ∂</button>
                    </div>
                    <div class="calendar-day-names">
                        <div class="day-name">Ïùº</div>
                        <div class="day-name">Ïõî</div>
                        <div class="day-name">Ìôî</div>
                        <div class="day-name">Ïàò</div>
                        <div class="day-name">Î™©</div>
                        <div class="day-name">Í∏à</div>
                        <div class="day-name">ÌÜ†</div>
                    </div>
                    <div class="calendar-grid" id="calendarGrid">
                    </div>
                </div>
            </div>

            <!-- Í≤∞Ï†ú Í∏àÏï° ÏÑπÏÖò -->
            <div id="payment" class="section">
                <h2>Í≤∞Ï†ú Í∏àÏï° Í¥ÄÎ¶¨</h2>
                <div class="form-group">
                    <select id="payGameName">
                        <option value="">Í≤åÏûÑ ÏÑ†ÌÉù</option>
                    </select>
                    <input type="number" id="amount" placeholder="Í≤∞Ï†ú Í∏àÏï° (Ïõê)" step="100">
                    <button class="btn" onclick="addPayment()">Í≤∞Ï†ú Í∏∞Î°ù Ï∂îÍ∞Ä</button>
                </div>

                <div class="table-container">
                    <table id="paymentTable">
                        <thead>
                            <tr>
                                <th>Í≤åÏûÑ</th>
                                <th>Í∏àÏï°</th>
                                <th>Í≤∞Ï†úÏùº</th>
                                <th>Í¥ÄÎ¶¨</th>
                            </tr>
                        </thead>
                        <tbody id="paymentBody">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- ÏöîÏïΩ ÏÑπÏÖò -->
            <div id="summary" class="section">
                <h2>ÌÜµÍ≥Ñ ÏöîÏïΩ</h2>
                <div class="summary-cards">
                    <div class="summary-card">
                        <h3 id="totalQuests">0</h3>
                        <p>Ï¥ù ÌÄòÏä§Ìä∏ Ïàò</p>
                    </div>
                    <div class="summary-card">
                        <h3 id="completedQuests">0</h3>
                        <p>ÏôÑÎ£åÎêú ÌÄòÏä§Ìä∏</p>
                    </div>
                    <div class="summary-card">
                        <h3 id="totalPayments">0Ïõê</h3>
                        <p>Ï¥ù Í≤∞Ï†ú Í∏àÏï°</p>
                    </div>
                    <div class="summary-card">
                        <h3 id="monthlyPayments">0Ïõê</h3>
                        <p>Ïù¥Îã¨ Í≤∞Ï†ú Í∏àÏï°</p>
                    </div>
                </div>

                <h3 style="margin-bottom: 20px; color: #374151;">Í≤åÏûÑÎ≥Ñ ÌÜµÍ≥Ñ</h3>
                <div class="summary-cards" id="gameStats">
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn export-btn" onclick="exportData()">Îç∞Ïù¥ÌÑ∞ ÎÇ¥Î≥¥ÎÇ¥Í∏∞</button>
                    <button class="btn btn-danger" onclick="clearAllData()">Î™®Îì† Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•ÏÜå
        let quests = [];
        let payments = [];
        let questCompletions = {}; // ÎÇ†ÏßúÎ≥Ñ ÌÄòÏä§Ìä∏ ÏôÑÎ£å ÏÉÅÌÉú Ï†ÄÏû•
        let currentDate = new Date();
        let deleteCallback = null; // ÏÇ≠Ï†ú ÏΩúÎ∞± Ìï®Ïàò

        // localStorage Í¥ÄÎ†® Ìï®Ïàò
        function saveData() {
            const data = {
                quests,
                payments,
                questCompletions,
                lastSaved: new Date().toISOString()
            };
            localStorage.setItem('gameManagerData', JSON.stringify(data));
            console.log('Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•Îê®:', data);
        }

        function loadData() {
            const savedData = localStorage.getItem('gameManagerData');
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    quests = data.quests || [];
                    payments = data.payments || [];
                    questCompletions = data.questCompletions || {};
                    console.log('Îç∞Ïù¥ÌÑ∞ Î°úÎìúÎê®:', data);
                    return true;
                } catch (error) {
                    console.error('Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®:', error);
                    return false;
                }
            }
            return false;
        }

        // Í≤åÏûÑ Î™©Î°ù Í¥ÄÎ¶¨
        function getGameList() {
            return [...new Set(quests.map(q => q.gameName))].sort();
        }

        function updateGameSelectors() {
            // ÏùºÏùºÌÄòÏä§Ìä∏ datalist ÏóÖÎç∞Ïù¥Ìä∏
            const gameList = document.getElementById('gameList');
            gameList.innerHTML = '';
            getGameList().forEach(gameName => {
                const option = document.createElement('option');
                option.value = gameName;
                gameList.appendChild(option);
            });

            // Í≤∞Ï†ú ÌÉ≠ select ÏóÖÎç∞Ïù¥Ìä∏
            const payGameSelect = document.getElementById('payGameName');
            const currentValue = payGameSelect.value;
            payGameSelect.innerHTML = '<option value="">Í≤åÏûÑ ÏÑ†ÌÉù</option>';
            getGameList().forEach(gameName => {
                const option = document.createElement('option');
                option.value = gameName;
                option.textContent = gameName;
                payGameSelect.appendChild(option);
            });
            payGameSelect.value = currentValue; // Í∏∞Ï°¥ ÏÑ†ÌÉù Ïú†ÏßÄ
        }

        // Î™®Îã¨ ÏÉùÏÑ± Ìï®Ïàò
        function createModal() {
            // Í∏∞Ï°¥ Î™®Îã¨Ïù¥ ÏûàÏúºÎ©¥ Ï†úÍ±∞
            const existingModal = document.getElementById('deleteModal');
            if (existingModal) {
                existingModal.remove();
            }

            // ÏÉà Î™®Îã¨ ÏÉùÏÑ±
            const modal = document.createElement('div');
            modal.id = 'deleteModal';
            modal.className = 'delete-modal';
            
            modal.innerHTML = `
                <div class="delete-modal-content">
                    <h3>ÏÇ≠Ï†ú ÌôïÏù∏</h3>
                    <p id="deleteMessage">Ï†ïÎßêÎ°ú ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?</p>
                    <div class="delete-modal-buttons">
                        <button class="btn btn-secondary" onclick="closeDeleteModal()">Ï∑®ÏÜå</button>
                        <button class="btn btn-danger" onclick="confirmDelete()">ÏÇ≠Ï†ú</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            console.log('Î™®Îã¨ ÎèôÏ†Å ÏÉùÏÑ±Îê®:', modal);
            return modal;
        }

        // ÏÇ≠Ï†ú Î™®Îã¨ Í¥ÄÎ†® Ìï®Ïàò
        function showDeleteModal(message, callback) {
            console.log('Î™®Îã¨ ÌëúÏãú ÏãúÎèÑ:', message);
            
            // Î™®Îã¨ ÏÉùÏÑ± ÎòêÎäî Ï∞æÍ∏∞
            let modal = document.getElementById('deleteModal');
            if (!modal) {
                console.log('Í∏∞Ï°¥ Î™®Îã¨Ïù¥ ÏóÜÏùå, ÏÉàÎ°ú ÏÉùÏÑ±');
                modal = createModal();
            }
            
            const messageElement = document.getElementById('deleteMessage');
            
            console.log('Î™®Îã¨ ÏöîÏÜå:', modal);
            console.log('Î©îÏãúÏßÄ ÏöîÏÜå:', messageElement);
            
            if (!modal) {
                console.error('Î™®Îã¨ ÏÉùÏÑ± Ïã§Ìå®');
                if (confirm(message)) {
                    callback();
                }
                return;
            }
            
            if (!messageElement) {
                console.error('Î©îÏãúÏßÄ ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                if (confirm(message)) {
                    callback();
                }
                return;
            }
            
            messageElement.textContent = message;
            modal.style.display = 'flex';
            modal.classList.add('show');
            deleteCallback = callback;
            
            console.log('Î™®Îã¨ ÌëúÏãúÎê®');
        }

        function closeDeleteModal() {
            console.log('Î™®Îã¨ Îã´Í∏∞');
            const modal = document.getElementById('deleteModal');
            if (modal) {
                modal.style.display = 'none';
                modal.classList.remove('show');
            }
            deleteCallback = null;
        }

        function confirmDelete() {
            console.log('ÏÇ≠Ï†ú ÌôïÏù∏');
            if (deleteCallback) {
                deleteCallback();
            }
            closeDeleteModal();
        }

        // ÌÉ≠ Ï†ÑÌôò
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
            
            document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'summary') {
                updateSummary();
            } else if (tabName === 'calendar') {
                renderCalendar();
            }
        }

        // ÌÄòÏä§Ìä∏ Ï∂îÍ∞Ä
        function addQuest() {
            const gameName = document.getElementById('gameName').value.trim();

            if (!gameName) {
                alert('Í≤åÏûÑ Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            // Ïù¥ÎØ∏ Ï°¥Ïû¨ÌïòÎäî Í≤åÏûÑÏù∏ÏßÄ ÌôïÏù∏
            const existingQuest = quests.find(q => q.gameName === gameName);
            if (existingQuest) {
                alert('Ïù¥ÎØ∏ Îì±Î°ùÎêú Í≤åÏûÑÏûÖÎãàÎã§.');
                return;
            }

            const quest = {
                id: Date.now(),
                gameName
            };

            quests.push(quest);
            saveData();
            renderQuests();
            updateGameSelectors();
            clearQuestForm();
        }

        // Í≤∞Ï†ú ÎÇ¥Ïó≠ Ï∂îÍ∞Ä
        function addPayment() {
            const payGameName = document.getElementById('payGameName').value;
            const amount = parseInt(document.getElementById('amount').value);

            if (!payGameName) {
                alert('Í≤åÏûÑÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            if (!amount || amount <= 0) {
                alert('Ïò¨Î∞îÎ•∏ Í∏àÏï°ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            const payment = {
                id: Date.now(),
                gameName: payGameName,
                amount,
                date: new Date().toLocaleDateString('ko-KR')
            };

            payments.push(payment);
            saveData();
            renderPayments();
            clearPaymentForm();
        }

        // ÌÄòÏä§Ìä∏ Î†åÎçîÎßÅ
        function renderQuests() {
            const tbody = document.getElementById('questBody');
            tbody.innerHTML = '';

            const today = new Date().toDateString();

            quests.forEach((quest, index) => {
                const row = document.createElement('tr');
                
                // Í≤åÏûÑÎ™Ö
                const gameCell = document.createElement('td');
                gameCell.textContent = quest.gameName;
                row.appendChild(gameCell);

                // ÏÉÅÌÉú (Ïò§Îäò Í∏∞Ï§Ä)
                const statusCell = document.createElement('td');
                const isCompleted = questCompletions[today] && questCompletions[today][quest.id];
                
                const statusBtn = document.createElement('button');
                statusBtn.className = isCompleted ? 'btn btn-success' : 'btn btn-secondary';
                statusBtn.textContent = isCompleted ? 'ÏôÑÎ£å' : 'ÎØ∏ÏôÑÎ£å';
                statusBtn.addEventListener('click', function() {
                    toggleQuestCompletion(quest.id, today);
                });
                statusCell.appendChild(statusBtn);
                row.appendChild(statusCell);

                // Í¥ÄÎ¶¨ (ÏÇ≠Ï†ú Î≤ÑÌäº)
                const manageCell = document.createElement('td');
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'btn btn-danger';
                deleteBtn.textContent = 'ÏÇ≠Ï†ú';
                deleteBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const message = `"${quest.gameName}" Í≤åÏûÑÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n(Í¥ÄÎ†®Îêú Î™®Îì† ÏôÑÎ£å Í∏∞Î°ùÍ≥º Í≤∞Ï†ú ÎÇ¥Ïó≠ÎèÑ Ìï®Íªò ÏÇ≠Ï†úÎê©ÎãàÎã§)`;
                    
                    showDeleteModal(message, function() {
                        // ÌÄòÏä§Ìä∏ Î∞∞Ïó¥ÏóêÏÑú Ï†úÍ±∞
                        quests.splice(index, 1);
                        
                        // ÏôÑÎ£å Í∏∞Î°ùÏóêÏÑúÎèÑ Ï†úÍ±∞
                        Object.keys(questCompletions).forEach(date => {
                            if (questCompletions[date] && questCompletions[date][quest.id]) {
                                delete questCompletions[date][quest.id];
                            }
                        });
                        
                        // Ìï¥Îãπ Í≤åÏûÑÏùò Í≤∞Ï†ú ÎÇ¥Ïó≠ÎèÑ Ï†úÍ±∞
                        payments = payments.filter(p => p.gameName !== quest.gameName);
                        
                        saveData();
                        renderQuests();
                        renderPayments();
                        renderCalendar();
                        updateSummary();
                        updateGameSelectors();
                    });
                });
                manageCell.appendChild(deleteBtn);
                row.appendChild(manageCell);

                tbody.appendChild(row);
            });
        }

        // Í≤∞Ï†ú ÎÇ¥Ïó≠ Î†åÎçîÎßÅ
        function renderPayments() {
            const tbody = document.getElementById('paymentBody');
            tbody.innerHTML = '';

            payments.forEach((payment, index) => {
                const row = document.createElement('tr');
                
                const gameCell = document.createElement('td');
                gameCell.textContent = payment.gameName;
                row.appendChild(gameCell);

                const amountCell = document.createElement('td');
                amountCell.textContent = payment.amount.toLocaleString() + 'Ïõê';
                row.appendChild(amountCell);

                const dateCell = document.createElement('td');
                dateCell.textContent = payment.date;
                row.appendChild(dateCell);

                const manageCell = document.createElement('td');
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'btn btn-danger';
                deleteBtn.textContent = 'ÏÇ≠Ï†ú';
                deleteBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const message = `"${payment.gameName}" Í≤åÏûÑÏùò ${payment.amount.toLocaleString()}Ïõê Í≤∞Ï†ú ÎÇ¥Ïó≠ÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?`;
                    
                    showDeleteModal(message, function() {
                        payments.splice(index, 1);
                        
                        saveData();
                        renderPayments();
                        updateSummary();
                    });
                });
                manageCell.appendChild(deleteBtn);
                row.appendChild(manageCell);

                tbody.appendChild(row);
            });
        }

        // ÌÄòÏä§Ìä∏ ÏôÑÎ£å ÌÜ†Í∏Ä
        function toggleQuestCompletion(questId, dateString) {
            if (!questCompletions[dateString]) {
                questCompletions[dateString] = {};
            }
            questCompletions[dateString][questId] = !questCompletions[dateString][questId];
            saveData();
            renderQuests();
            renderCalendar();
            updateSummary();
        }

        // Îã¨Î†• Î†åÎçîÎßÅ
        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            document.getElementById('currentMonth').textContent = `${year}ÎÖÑ ${month + 1}Ïõî`;
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            const calendarGrid = document.getElementById('calendarGrid');
            calendarGrid.innerHTML = '';
            
            const today = new Date();
            
            for (let i = 0; i < 42; i++) {
                const cellDate = new Date(startDate);
                cellDate.setDate(startDate.getDate() + i);
                
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                
                if (cellDate.getMonth() !== month) {
                    dayElement.classList.add('other-month');
                }
                
                if (cellDate.toDateString() === today.toDateString()) {
                    dayElement.classList.add('today');
                }
                
                const dayNumber = document.createElement('div');
                dayNumber.className = 'day-number';
                dayNumber.textContent = cellDate.getDate();
                dayElement.appendChild(dayNumber);
                
                // Ìï¥Îãπ ÎÇ†ÏßúÏùò ÌÄòÏä§Ìä∏ ÏôÑÎ£å ÏÉÅÌÉú ÌëúÏãú
                const dateString = cellDate.toDateString();
                if (questCompletions[dateString]) {
                    quests.forEach(quest => {
                        const dot = document.createElement('span');
                        dot.className = 'quest-dot';
                        if (questCompletions[dateString][quest.id]) {
                            dot.classList.add('quest-complete');
                            dot.title = `${quest.gameName} (ÏôÑÎ£å)`;
                        } else {
                            dot.classList.add('quest-incomplete');
                            dot.title = `${quest.gameName} (ÎØ∏ÏôÑÎ£å)`;
                        }
                        dayElement.appendChild(dot);
                    });
                }
                
                calendarGrid.appendChild(dayElement);
            }
        }

        // Îã¨ Î≥ÄÍ≤Ω
        function changeMonth(delta) {
            currentDate.setMonth(currentDate.getMonth() + delta);
            renderCalendar();
        }

        // ÏöîÏïΩ ÏóÖÎç∞Ïù¥Ìä∏
        function updateSummary() {
            const totalQuests = quests.length;
            const today = new Date().toDateString();
            const completedToday = questCompletions[today] ? 
                Object.values(questCompletions[today]).filter(Boolean).length : 0;
            
            const totalPayments = payments.reduce((sum, p) => sum + p.amount, 0);
            
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            const monthlyPayments = payments.filter(p => {
                const [year, month] = p.date.split('. ');
                return parseInt(month) - 1 === currentMonth && parseInt(year) === currentYear;
            }).reduce((sum, p) => sum + p.amount, 0);

            document.getElementById('totalQuests').textContent = totalQuests;
            document.getElementById('completedQuests').textContent = completedToday;
            document.getElementById('totalPayments').textContent = totalPayments.toLocaleString() + 'Ïõê';
            document.getElementById('monthlyPayments').textContent = monthlyPayments.toLocaleString() + 'Ïõê';

            updateGameStats();
        }

        // Í≤åÏûÑÎ≥Ñ ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
        function updateGameStats() {
            const gameStatsContainer = document.getElementById('gameStats');
            if (!gameStatsContainer) return;

            const allGames = [...new Set([
                ...quests.map(q => q.gameName),
                ...payments.map(p => p.gameName)
            ])];

            gameStatsContainer.innerHTML = '';

            allGames.forEach(gameName => {
                const gameQuests = quests.filter(q => q.gameName === gameName);
                const gamePayments = payments.filter(p => p.gameName === gameName);
                
                const today = new Date().toDateString();
                const completedGameQuests = gameQuests.filter(q => 
                    questCompletions[today] && questCompletions[today][q.id]
                ).length;
                
                const totalGamePayment = gamePayments.reduce((sum, p) => sum + p.amount, 0);

                const gameCard = document.createElement('div');
                gameCard.className = 'summary-card';
                gameCard.innerHTML = `
                    <h4 style="color: #4f46e5; margin-bottom: 10px;">${gameName}</h4>
                    <p>Ïò§Îäò ÌÄòÏä§Ìä∏: ${completedGameQuests}/${gameQuests.length}Í∞ú ÏôÑÎ£å</p>
                    <p>Ï¥ù Í≤∞Ï†ú: ${totalGamePayment.toLocaleString()}Ïõê</p>
                `;
                gameStatsContainer.appendChild(gameCard);
            });
        }

        // Ìèº Ï¥àÍ∏∞Ìôî
        function clearQuestForm() {
            document.getElementById('gameName').value = '';
        }

        function clearPaymentForm() {
            document.getElementById('payGameName').value = '';
            document.getElementById('amount').value = '';
        }

        // Îç∞Ïù¥ÌÑ∞ ÎÇ¥Î≥¥ÎÇ¥Í∏∞
        function exportData() {
            const data = {
                quests,
                payments,
                questCompletions,
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `Í≤åÏûÑÍ¥ÄÎ¶¨_${new Date().toLocaleDateString('ko-KR').replace(/\./g, '').replace(/ /g, '')}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Î™®Îì† Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú
        function clearAllData() {
            const message = 'Î™®Îì† Îç∞Ïù¥ÌÑ∞Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?\nÏù¥ ÏûëÏóÖÏùÄ ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏäµÎãàÎã§.';
            
            showDeleteModal(message, function() {
                quests.length = 0;
                payments.length = 0;
                questCompletions = {};
                
                localStorage.removeItem('gameManagerData');
                
                renderQuests();
                renderPayments();
                renderCalendar();
                updateSummary();
                updateGameSelectors();
            });
        }

        // Ï¥àÍ∏∞ Î†åÎçîÎßÅ
        loadData();
        
        renderQuests();
        renderPayments();
        renderCalendar();
        updateSummary();
        updateGameSelectors();

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Î™®Îã¨ ÎØ∏Î¶¨ ÏÉùÏÑ±
        createModal();
        console.log('localStorage Í∏∞Îä•Ïù¥ ÌôúÏÑ±ÌôîÎêòÏóàÏäµÎãàÎã§.');
    </script>
</body>
</html>